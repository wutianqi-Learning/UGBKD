2024-06-06 16:16:05,078 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Configure stats pid to 252731
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Loading settings from /home/jz207/.config/wandb/settings
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Loading settings from /home/jz207/workspace/zhangdw/monai_mmengine/wandb/settings
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Loading settings from environment variables: {'mode': 'offline'}
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Applying setup settings: {'_disable_service': False}
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_setup.py:_flush():76] Inferring run settings from compute environment: {'program_relpath': 'test.py', 'program': 'test.py'}
2024-06-06 16:16:05,081 INFO    MainThread:252731 [wandb_init.py:_log_setup():507] Logging user logs to /home/jz207/workspace/zhangdw/monai_mmengine/save_dirs/multiscale_eta050_swinunetr_base_espnetv2_300e_sgd_word_96x96x96/20240606_161600/vis_data/wandb/offline-run-20240606_161605-ywy23dnu/logs/debug.log
2024-06-06 16:16:05,082 INFO    MainThread:252731 [wandb_init.py:_log_setup():508] Logging internal logs to /home/jz207/workspace/zhangdw/monai_mmengine/save_dirs/multiscale_eta050_swinunetr_base_espnetv2_300e_sgd_word_96x96x96/20240606_161600/vis_data/wandb/offline-run-20240606_161605-ywy23dnu/logs/debug-internal.log
2024-06-06 16:16:05,082 INFO    MainThread:252731 [wandb_init.py:init():547] calling init triggers
2024-06-06 16:16:05,082 INFO    MainThread:252731 [wandb_init.py:init():554] wandb.init called with sweep_config: {}
config: {}
2024-06-06 16:16:05,082 INFO    MainThread:252731 [wandb_init.py:init():595] starting backend
2024-06-06 16:16:05,082 INFO    MainThread:252731 [wandb_init.py:init():599] setting up manager
2024-06-06 16:16:05,086 INFO    MainThread:252731 [backend.py:_multiprocessing_setup():106] multiprocessing start_methods=fork,spawn,forkserver, using: spawn
2024-06-06 16:16:05,099 INFO    MainThread:252731 [wandb_init.py:init():605] backend started and connected
2024-06-06 16:16:05,106 INFO    MainThread:252731 [wandb_init.py:init():695] updated telemetry
2024-06-06 16:16:05,107 INFO    MainThread:252731 [wandb_init.py:init():782] starting run threads in backend
2024-06-06 16:16:06,656 INFO    MainThread:252731 [wandb_run.py:_console_start():2157] atexit reg
2024-06-06 16:16:06,656 INFO    MainThread:252731 [wandb_run.py:_redirect():2012] redirect: SettingsConsole.WRAP_RAW
2024-06-06 16:16:06,656 INFO    MainThread:252731 [wandb_run.py:_redirect():2077] Wrapping output streams.
2024-06-06 16:16:06,656 INFO    MainThread:252731 [wandb_run.py:_redirect():2102] Redirects installed.
2024-06-06 16:16:06,657 INFO    MainThread:252731 [wandb_init.py:init():824] run started, returning control to user process
2024-06-06 16:16:10,745 INFO    MainThread:252731 [wandb_run.py:_config_callback():1285] config_cb None None {'MonaiMetric': 'seg.evaluation.metrics.monai_metric.MonaiMetric', 'MonaiEvaluator': 'seg.evaluation.monai_evaluator.MonaiEvaluator', 'WORD_METAINFO': {'classes': ['background', 'liver', 'spleen', 'left_kidney', 'right_kidney', 'stomach', 'gallbladder', 'esophagus', 'pancreas', 'duodenum', 'colon', 'intestine', 'adrenal', 'rectum', 'bladder', 'Head_of_femur_L', 'Head_of_femur_R'], 'palette': [[0, 0, 0], [255, 0, 0], [0, 255, 0], [0, 0, 255], [255, 255, 0], [0, 255, 255], [255, 0, 255], [255, 239, 213], [0, 0, 205], [205, 133, 63], [210, 180, 140], [102, 205, 170], [0, 0, 128], [0, 139, 0], [139, 0, 139], [139, 139, 0], [139, 0, 0]]}, 'roi': [96, 96, 96], 'dataloader_cfg': {'data_name': 'WORD', 'data_dir': 'data/WORD', 'json_list': 'dataset.json', 'train_case_nums': 100, 'meta_info': {'classes': ['background', 'liver', 'spleen', 'left_kidney', 'right_kidney', 'stomach', 'gallbladder', 'esophagus', 'pancreas', 'duodenum', 'colon', 'intestine', 'adrenal', 'rectum', 'bladder', 'Head_of_femur_L', 'Head_of_femur_R'], 'palette': [[0, 0, 0], [255, 0, 0], [0, 255, 0], [0, 0, 255], [255, 255, 0], [0, 255, 255], [255, 0, 255], [255, 239, 213], [0, 0, 205], [205, 133, 63], [210, 180, 140], [102, 205, 170], [0, 0, 128], [0, 139, 0], [139, 0, 139], [139, 139, 0], [139, 0, 0]]}, 'use_normal_dataset': True, 'use_smart_dataset': False, 'batch_size': 1, 'num_samples': 4, 'workers': 2, 'distributed': False, 'space_x': 1.5, 'space_y': 1.5, 'space_z': 2.0, 'a_min': -175.0, 'a_max': 250, 'b_min': 0.0, 'b_max': 1.0, 'roi_x': 96, 'roi_y': 96, 'roi_z': 96, 'RandFlipd_prob': 0.2, 'RandRotate90d_prob': 0.2, 'RandScaleIntensityd_prob': 0.1, 'RandShiftIntensityd_prob': 0.1, 'use_test_data': False}, 'val_evaluator': {'type': 'seg.evaluation.monai_evaluator.MonaiEvaluator', 'metrics': {'type': 'seg.evaluation.metrics.monai_metric.MonaiMetric', 'metrics': ['Dice', 'HD95'], 'num_classes': 17}}, 'test_evaluator': {'type': 'seg.evaluation.monai_evaluator.MonaiEvaluator', 'metrics': {'type': 'seg.evaluation.metrics.monai_metric.MonaiMetric', 'metrics': ['Dice', 'HD95'], 'num_classes': 17}}, 'SGD': 'torch.optim.sgd.SGD', 'PolyLR': 'mmengine.optim.scheduler.lr_scheduler.PolyLR', 'OptimWrapper': 'mmengine.optim.optimizer.optimizer_wrapper.OptimWrapper', 'IterTimerHook': 'mmengine.hooks.iter_timer_hook.IterTimerHook', 'ParamSchedulerHook': 'mmengine.hooks.param_scheduler_hook.ParamSchedulerHook', 'DistSamplerSeedHook': 'mmengine.hooks.sampler_seed_hook.DistSamplerSeedHook', 'EmptyCacheHook': 'seg.engine.hooks.empty_cache_hook.EmptyCacheHook', 'SegVisualizationHook': 'mmseg.engine.hooks.visualization_hook.SegVisualizationHook', 'MyCheckpointHook': 'seg.engine.hooks.checkpoint_hook.MyCheckpointHook', 'MyLoggerHook': 'seg.engine.hooks.logger_hook.MyLoggerHook', 'EpochBasedTrainLoop': 'mmengine.runner.loops.EpochBasedTrainLoop', 'MonaiValLoop': 'seg.engine.runner.monai_loops.MonaiValLoop', 'MonaiTestLoop': 'seg.engine.runner.monai_loops.MonaiTestLoop', 'train_cfg': {'type': 'mmengine.runner.loops.EpochBasedTrainLoop', 'max_epochs': 300, 'val_begin': 100, 'val_interval': 25}, 'val_cfg': {'type': 'seg.engine.runner.monai_loops.MonaiValLoop'}, 'test_cfg': {'type': 'seg.engine.runner.monai_loops.MonaiTestLoop'}, 'optimizer': {'type': 'torch.optim.sgd.SGD', 'lr': 0.01, 'momentum': 0.9, 'weight_decay': 0.0005}, 'optim_wrapper': {'type': 'mmengine.optim.optimizer.optimizer_wrapper.OptimWrapper', 'optimizer': {'type': 'torch.optim.sgd.SGD', 'lr': 0.01, 'momentum': 0.9, 'weight_decay': 0.0005}, 'clip_grad': None}, 'param_scheduler': [{'type': 'mmengine.optim.scheduler.lr_scheduler.PolyLR', 'eta_min': 1e-06, 'power': 0.9, 'begin': 0, 'end': 300, 'by_epoch': True}], 'default_hooks': {'timer': {'type': 'mmengine.hooks.iter_timer_hook.IterTimerHook'}, 'logger': {'type': 'seg.engine.hooks.logger_hook.MyLoggerHook', 'interval': 10, 'val_interval': 1}, 'param_scheduler': {'type': 'mmengine.hooks.param_scheduler_hook.ParamSchedulerHook'}, 'checkpoint': {'type': 'seg.engine.hooks.checkpoint_hook.MyCheckpointHook', 'by_epoch': True, 'interval': 25, 'max_keep_ckpts': 1, 'save_best': ['Dice'], 'rule': 'greater'}, 'sampler_seed': {'type': 'mmengine.hooks.sampler_seed_hook.DistSamplerSeedHook'}, 'visualization': {'type': 'mmseg.engine.hooks.visualization_hook.SegVisualizationHook'}}, 'custom_hooks': [{'type': 'seg.engine.hooks.empty_cache_hook.EmptyCacheHook', 'before_epoch': False, 'after_epoch': True, 'after_iter': False}, {'type': 'seg.engine.hooks.schedule_hook.DistillLossWeightScheduleHookV2', 'loss_names': ['loss_dsd1', 'loss_dsd2', 'loss_dsd3'], 'eta_min': 0.5, 'gamma': 0.0016666666666666668}], 'MonaiRunner': 'seg.engine.runner.monai_runner.MonaiRunner', 'LocalVisBackend': 'mmengine.visualization.vis_backend.LocalVisBackend', 'WandbVisBackend': 'mmengine.visualization.vis_backend.WandbVisBackend', 'SegLocalVisualizer': 'mmseg.visualization.local_visualizer.SegLocalVisualizer', 'runner_type': 'seg.engine.runner.monai_runner.MonaiRunner', 'default_scope': None, 'env_cfg': {'cudnn_benchmark': True, 'mp_cfg': {'mp_start_method': 'fork', 'opencv_num_threads': 0}, 'dist_cfg': {'backend': 'nccl'}}, 'vis_backends': [{'type': 'mmengine.visualization.vis_backend.LocalVisBackend'}, {'type': 'mmengine.visualization.vis_backend.WandbVisBackend', 'init_kwargs': {'project': 'mmsegmentation', 'name': 'exp'}, 'define_metric_cfg': {'Dice': 'max'}}], 'visualizer': {'type': 'mmseg.visualization.local_visualizer.SegLocalVisualizer', 'vis_backends': [{'type': 'mmengine.visualization.vis_backend.LocalVisBackend'}, {'type': 'mmengine.visualization.vis_backend.WandbVisBackend', 'init_kwargs': {'project': 'mmsegmentation', 'name': 'exp'}, 'define_metric_cfg': {'Dice': 'max'}}], 'name': 'visualizer'}, 'log_processor': {'by_epoch': True}, 'log_level': 'INFO', 'load_from': 'work_dirs/multiscale_eta050_swinunetr_base_espnetv2_300e_sgd_word_96x96x96/5-run_20240518_180058/run3/best_Dice_78-48_epoch_300.pth', 'resume': False, 'test_mode': True, 'save': True, 'teacher_model': {'type': 'seg.models.segmentors.monai_model.MonaiSeg', 'num_classes': 17, 'roi_shapes': [96, 96, 96], 'backbone': {'type': 'monai.networks.nets.swin_unetr.SwinUNETR', 'img_size': [96, 96, 96], 'feature_size': 48, 'in_channels': 1, 'out_channels': 17, 'spatial_dims': 3}, 'loss_functions': {'type': 'monai.losses.dice.DiceCELoss', 'to_onehot_y': True, 'softmax': True}, 'infer_cfg': {'inf_size': [96, 96, 96], 'sw_batch_size': 2, 'infer_overlap': 0.5}}, 'student_model': {'type': 'seg.models.segmentors.monai_model.MonaiSeg', 'num_classes': 14, 'roi_shapes': [96, 96, 96], 'backbone': {'type': 'seg.models.nets.espnetv2.ESPNetv2Segmentation', 'classes': 17, 'args': {'s': 1.0, 'channels': 1, 'num_classes': 17}}, 'loss_functions': {'type': 'monai.losses.dice.DiceCELoss', 'to_onehot_y': True, 'softmax': True}, 'infer_cfg': {'inf_size': [96, 96, 96], 'sw_batch_size': 1, 'infer_overlap': 0.5}}, 'read_base': 'mmengine.config.config.read_base', 'SingleTeacherDistill': 'razor.models.algorithms.distill.configurable.single_teacher_distill.SingleTeacherDistill', 'ConfigurableDistiller': 'razor.models.distillers.configurable_distiller.ConfigurableDistiller', 'ModuleOutputsRecorder': 'mmrazor.models.task_modules.recorder.module_outputs_recorder.ModuleOutputsRecorder', 'ModuleInputsRecorder': 'mmrazor.models.task_modules.recorder.module_inputs_recorder.ModuleInputsRecorder', 'DSDLoss8': 'razor.models.losses.dsd.DSDLoss8', 'DistillLossWeightScheduleHookV2': 'seg.engine.hooks.schedule_hook.DistillLossWeightScheduleHookV2', 'num_classes': 17, 'epoches': 300, 'teacher_ckpt': 'ckpts/swinunetr_base_1000e_word/best_Dice_84-89_epoch_1000.pth', 'model': {'type': 'razor.models.algorithms.distill.configurable.single_teacher_distill.SingleTeacherDistill', 'architecture': {'cfg_path': {'type': 'seg.models.segmentors.monai_model.MonaiSeg', 'num_classes': 14, 'roi_shapes': [96, 96, 96], 'backbone': {'type': 'seg.models.nets.espnetv2.ESPNetv2Segmentation', 'classes': 17, 'args': {'s': 1.0, 'channels': 1, 'num_classes': 17}}, 'loss_functions': {'type': 'monai.losses.dice.DiceCELoss', 'to_onehot_y': True, 'softmax': True}, 'infer_cfg': {'inf_size': [96, 96, 96], 'sw_batch_size': 1, 'infer_overlap': 0.5}}, 'pretrained': False}, 'teacher': {'cfg_path': {'type': 'seg.models.segmentors.monai_model.MonaiSeg', 'num_classes': 17, 'roi_shapes': [96, 96, 96], 'backbone': {'type': 'monai.networks.nets.swin_unetr.SwinUNETR', 'img_size': [96, 96, 96], 'feature_size': 48, 'in_channels': 1, 'out_channels': 17, 'spatial_dims': 3}, 'loss_functions': {'type': 'monai.losses.dice.DiceCELoss', 'to_onehot_y': True, 'softmax': True}, 'infer_cfg': {'inf_size': [96, 96, 96], 'sw_batch_size': 2, 'infer_overlap': 0.5}}, 'pretrained': False}, 'teacher_ckpt': 'ckpts/swinunetr_base_1000e_word/best_Dice_84-89_epoch_1000.pth', 'distiller': {'type': 'razor.models.distillers.configurable_distiller.ConfigurableDistiller', 'distill_losses': {'loss_dsd1': {'type': 'razor.models.losses.dsd.DSDLoss8', 'interpolate': True, 'in_chans': 48, 'num_classes': 17, 'num_stages': 3, 'cur_stage': 1, 'loss_weight': 1.0}, 'loss_dsd2': {'type': 'razor.models.losses.dsd.DSDLoss8', 'interpolate': True, 'in_chans': 32, 'num_classes': 17, 'num_stages': 3, 'cur_stage': 2, 'loss_weight': 1.0}, 'loss_dsd3': {'type': 'razor.models.losses.dsd.DSDLoss8', 'in_chans': 17, 'num_classes': 17, 'num_stages': 3, 'cur_stage': 3, 'loss_weight': 1.0}}, 'student_recorders': {'feat1': {'type': 'mmrazor.models.task_modules.recorder.module_outputs_recorder.ModuleOutputsRecorder', 'source': 'segmentor.backbone.bu_dec_l2'}, 'feat2': {'type': 'mmrazor.models.task_modules.recorder.module_outputs_recorder.ModuleOutputsRecorder', 'source': 'segmentor.backbone.bu_dec_l3'}, 'logits': {'type': 'mmrazor.models.task_modules.recorder.module_outputs_recorder.ModuleOutputsRecorder', 'source': 'segmentor'}, 'gt_labels': {'type': 'mmrazor.models.task_modules.recorder.module_inputs_recorder.ModuleInputsRecorder', 'source': 'loss_functions'}}, 'teacher_recorders': {'logits': {'type': 'mmrazor.models.task_modules.recorder.module_outputs_recorder.ModuleOutputsRecorder', 'source': 'segmentor'}}, 'loss_forward_mappings': {'loss_dsd1': {'feat_student': {'from_student': True, 'recorder': 'feat1'}, 'logits_teacher': {'from_student': False, 'recorder': 'logits'}, 'label': {'recorder': 'gt_labels', 'from_student': True, 'data_idx': 1}}, 'loss_dsd2': {'feat_student': {'from_student': True, 'recorder': 'feat2'}, 'logits_teacher': {'from_student': False, 'recorder': 'logits'}, 'label': {'recorder': 'gt_labels', 'from_student': True, 'data_idx': 1}}, 'loss_dsd3': {'feat_student': {'from_student': True, 'recorder': 'logits'}, 'logits_teacher': {'from_student': False, 'recorder': 'logits'}, 'label': {'recorder': 'gt_labels', 'from_student': True, 'data_idx': 1}}}}}, 'find_unused_parameters': True, 'launcher': 'none', 'work_dir': './save_dirs/multiscale_eta050_swinunetr_base_espnetv2_300e_sgd_word_96x96x96'}
2024-06-06 16:18:01,279 WARNING MsgRouterThr:252731 [router.py:message_loop():77] message_loop has been closed
